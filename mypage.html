<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>마이페이지 - 스터디크랙</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/mypage.css">
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.1390.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/amazon-cognito-identity-js@6.3.3/dist/amazon-cognito-identity.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <header>
        <div class="logo-container">
            <a href="index.html" style="display: flex; align-items: center; gap: 10px;">
                <span class="logo">StudyCrack</span>
            </a>
        </div>
        <nav class="nav-links">
            <a href="#" onclick="handleSignOut()" class="nav-btn">로그아웃</a>
        </nav>
    </header>

    <div class="mypage-container">
        <aside class="profile-summary">
            <div class="profile-pic-area">
                <img src="https://placehold.co/150x150?text=Profile" 
                     onerror="this.src='assets/images/sample_profile.png'" 
                     alt="프로필" class="profile-img">
                <button class="edit-pic-btn" onclick="alert('준비 중인 기능입니다.')">+</button>
            </div>
            
            <h2 id="userNameDisplay">-</h2>
            <p id="userEmailDisplay">-</p>
            
            <div class="survey-status-box">
                <h4>기초조사서 상태</h4>
                <div id="statusBadge" class="status-badge incomplete">로딩 중...</div>
                <ul class="status-detail">
                    <li>정성 데이터: <span id="qualStatus">-</span></li>
                    <li>정량 데이터: <span id="quanStatus">-</span></li>
                </ul>
                <a href="survey.html" class="btn-go-survey">📝 기초조사서 작성/수정하러 가기</a>
            </div>
            
            <div class="account-actions">
                <button onclick="handleDeleteAccount()" class="btn-delete-account">회원 탈퇴</button>
            </div>
        </aside>

        <main class="content-area">
            <div class="main-tabs">
                <button class="tab-btn active" onclick="switchMainTab('info')">내 정보 관리</button>
                <button class="tab-btn" onclick="switchMainTab('solution')">나만의 솔루션</button>
            </div>

            <div id="tab-info" class="tab-content active">
                <div class="content-header">
                    <h2>내 정보 관리</h2>
                    <p>개인정보 및 계정 설정을 변경할 수 있습니다.</p>
                </div>
                <div class="form-container">
                    <h3>기본 인적사항</h3>
                    <div class="form-group"><label>이름</label><input type="text" id="profileName"></div>
                    <div class="form-group"><label>전화번호</label><input type="tel" id="profilePhone"></div>
                    <div class="form-group"><label>학교</label><input type="text" id="profileSchool"></div>
                    
                    <h3>계정 정보 변경</h3>
                    <div class="form-group"><label>이메일</label><input type="email" id="profileEmail" placeholder="변경할 이메일 주소"></div>
                    <div class="password-section">
                        <div class="form-group"><label>새 비밀번호</label><input type="password" id="newPassword" placeholder="변경 시에만 입력"></div>
                        <div class="form-group"><label>새 비밀번호 확인</label><input type="password" id="newPasswordConfirm" placeholder="비밀번호 재입력"></div>
                    </div>
                    <button class="save-btn" onclick="saveProfile()">회원 정보 수정 저장</button>
                </div>
            </div>

            <div id="tab-solution" class="tab-content">
                <div class="solution-menu">
                    <button class="sol-btn active" onclick="openSolution('univ')">
                        <i class="fas fa-university"></i><span>목표대학</span>
                    </button>
                    <button class="sol-btn" onclick="openSolution('sim')">
                        <i class="fas fa-chart-line"></i><span>점수 시뮬레이션</span>
                    </button>
                    <button class="sol-btn" onclick="openSolution('coach')">
                        <i class="fas fa-chalkboard-teacher"></i><span>플래너 코칭</span>
                    </button>
                    <button class="sol-btn black-btn" onclick="openSolution('black')">
                        <i class="fas fa-crown"></i><span>FOR BLACK</span>
                    </button>
                </div>

                <div id="sol-univ" class="sol-content active">
                    <div class="univ-sub-header">
                        <h3>1. 목표대학 설정</h3>
                        <p class="warning-text">⚠️ 목표 대학 설정 시 <strong>2주간 수정이 불가능</strong>합니다.</p>
                    </div>
                    
                    <div class="univ-grid" id="univGrid"></div>
                    <button id="btnSaveTarget" class="save-btn" onclick="saveTargetUnivs()">설정 저장하기 (2주 락 적용)</button>

                    <hr class="divider">

                    <div class="univ-sub-header">
                        <h3>2. 목표대학 기본분석</h3>
                        <p>저장된 목표 대학의 입시 결과(추정)와 내 환산 점수를 비교합니다.</p>
                    </div>
                    
                    <div id="univAnalysisResult" class="analysis-container">
                        <p style="text-align:center; color:#94a3b8; padding:30px;">목표 대학을 설정하면 분석 결과가 나타납니다.</p>
                    </div>
                </div>

                <div id="sol-sim" class="sol-content">
                    <div class="content-header">
                        <h2>점수 상승 시뮬레이션</h2>
                        <p>현재 점수를 기반으로 목표 대학 합격 가능성을 시뮬레이션합니다.</p>
                    </div>
                    <div class="placeholder-box">
                        <p>Standard 버전 이상 기능</p>
                        <div class="chart-mockup">[그래프 영역]</div>
                    </div>
                </div>

                <div id="sol-coach" class="sol-content">
                    <div class="content-header">
                        <h2>플래너 코칭</h2>
                        <p>학습 계획을 점검하고 코멘트를 확인하세요.</p>
                    </div>
                    <div class="coach-container">
                        <div class="coach-box clickable" id="weeklyBox" onclick="openWeeklyCheckModal()">
                            <h3>📅 주간 학습 점검</h3>
                            <p>이번 주 학습 달성률과 상태를 점검합니다. (매주 월요일 리셋)</p>
                            <div id="weeklyStatusInfo" style="margin-top:10px; font-size:0.85rem;">
                                <span id="weeklyStatusBadge" class="badge-status pending">미제출</span>
                                <span id="weeklyDeadlineMsg" style="color:#64748b; margin-left:5px;"></span>
                            </div>
                            <span class="badge-std">Standard 이상</span>
                        </div>
                        
                        <div class="coach-box deep-coaching clickable" onclick="openDeepCoachingModal()">
                            <h3>🧐 심층 코칭</h3>
                            <div class="lock-overlay" id="deepCoachingLock">
                                <i class="fas fa-lock"></i>
                                <p>PRO 버전 이상</p>
                            </div>
                            <div class="coach-content">
                                <p>전문 컨설턴트와의 1:1 정밀 진단 & 솔루션</p>
                                <span class="badge-pro">PRO Exclusive</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="sol-black" class="sol-content black-theme">
    <div class="black-header">
        <h2>THE BLACK : PRIVILEGE</h2>
        <p class="sub-slogan">완벽 그 이상의 설계를 위한, 오직 당신만을 위한 프라이빗 라운지</p>
    </div>
    
    <div class="black-intro-box">
        <div class="intro-text">
            <p class="highlight">"최상위 1%를 위한 입시의 본질을 꿰뚫다."</p>
            <ul class="benefit-list">
                <li><strong>Priority Care:</strong> 모든 질문에 대한 24시간 이내 최우선 답변 및 실시간 케어</li>
                <li><strong>Hyper-Personalized:</strong> 단순 조언을 넘어선, 개인별 입시/학습 정밀 로드맵 설계</li>
                <li><strong>Exclusive Network:</strong> 검증된 BLACK 회원들 간의 심도 있는 입시 정보 공유</li>
                <li><strong>Master's Insight:</strong> 스터디크랙 컨설턴트들이 제공하는 시크릿 칼럼 및 분석 자료</li>
            </ul>
        </div>
    </div>

    <div class="black-menu-grid">
        <div class="black-tile" onclick="location.href='black_consult.html'">
            <div class="tile-icon"><i class="fas fa-user-tie"></i></div>
            <div class="tile-info">
                <h4>1:1 Private Consulting</h4>
                <p>전담 컨설턴트와의 시크릿 상담</p>
            </div>
            <div class="tile-arrow"><i class="fas fa-arrow-right"></i></div>
        </div>

        <div class="black-tile" onclick="location.href='black_community.html'">
            <div class="tile-icon"><i class="fas fa-users"></i></div>
            <div class="tile-info">
                <h4>BLACK Lounge</h4>
                <p>엄선된 정보와 깊이 있는 대화</p>
            </div>
            <div class="tile-arrow"><i class="fas fa-arrow-right"></i></div>
        </div>
    </div>
</div>
            </div>
        </main>
    </div>

    <div id="univSelectModal" class="modal">
        <div class="modal-content select-modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">대학 선택</h2>
                <span class="close-btn" onclick="closeUnivModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div id="stepUnivList" class="selection-grid"></div>
                <div id="stepMajorList" class="selection-grid" style="display:none;"></div>
            </div>
            <div class="modal-footer" id="modalFooter" style="display:none;">
                <button class="back-step-btn" onclick="showUnivStep()">← 대학 다시 선택</button>
            </div>
        </div>
    </div>
    
    <div id="weeklyCheckModal" class="modal">
        <div class="modal-content check-modal-content">
            <div class="modal-header">
                <h2 id="weeklyTitle">
                    <span id="weeklyYear">26년</span>
                    <span id="weeklyDateDetail">00월 0주차</span>
                    학습점검
                </h2>
                <span class="close-btn" onclick="closeWeeklyModal()">&times;</span>
            </div>
            <div class="modal-body scrollable">
                
                <div class="check-section">
                    <h4>1. 과목별 학습 달성률 <span class="req">*</span></h4>
                    <p class="desc">과목별 <strong>구체적인 과목명</strong>과 시간을 입력하세요.</p>
                    <div class="table-wrap">
                        <table class="study-time-table">
                            <thead>
                                <tr>
                                    <th>과목</th>
                                    <th>계획(H)</th>
                                    <th>실제(H)</th>
                                    <th>달성률</th>
                                </tr>
                            </thead>
                            <tbody id="studyTimeBody">
                                <tr>
                                    <td>
                                        <span class="main-sub">국어</span>
                                        <input type="text" class="sub-detail" placeholder="예: 언매">
                                    </td>
                                    <td><input type="number" class="plan-time" oninput="calcStudyRates()"></td>
                                    <td><input type="number" class="act-time" oninput="calcStudyRates()"></td>
                                    <td><span class="rate-txt">0%</span></td>
                                </tr>
                                <tr>
                                    <td>
                                        <span class="main-sub">수학</span>
                                        <input type="text" class="sub-detail" placeholder="예: 미적">
                                    </td>
                                    <td><input type="number" class="plan-time" oninput="calcStudyRates()"></td>
                                    <td><input type="number" class="act-time" oninput="calcStudyRates()"></td>
                                    <td><span class="rate-txt">0%</span></td>
                                </tr>
                                <tr>
                                    <td><span class="main-sub">영어</span></td>
                                    <td><input type="number" class="plan-time" oninput="calcStudyRates()"></td>
                                    <td><input type="number" class="act-time" oninput="calcStudyRates()"></td>
                                    <td><span class="rate-txt">0%</span></td>
                                </tr>
                                <tr>
                                    <td>
                                        <span class="main-sub">탐구1</span>
                                        <input type="text" class="sub-detail" placeholder="과목명">
                                    </td>
                                    <td><input type="number" class="plan-time" oninput="calcStudyRates()"></td>
                                    <td><input type="number" class="act-time" oninput="calcStudyRates()"></td>
                                    <td><span class="rate-txt">0%</span></td>
                                </tr>
                                <tr>
                                    <td>
                                        <span class="main-sub">탐구2</span>
                                        <input type="text" class="sub-detail" placeholder="과목명">
                                    </td>
                                    <td><input type="number" class="plan-time" oninput="calcStudyRates()"></td>
                                    <td><input type="number" class="act-time" oninput="calcStudyRates()"></td>
                                    <td><span class="rate-txt">0%</span></td>
                                </tr>
                                <tr>
                                    <td><input type="text" placeholder="기타(한국사 등)" class="custom-subj"></td>
                                    <td><input type="number" class="plan-time" oninput="calcStudyRates()"></td>
                                    <td><input type="number" class="act-time" oninput="calcStudyRates()"></td>
                                    <td><span class="rate-txt">0%</span></td>
                                </tr>
                            </tbody>
                            <tfoot>
                                <tr class="total-row">
                                    <td>총합</td>
                                    <td id="totalPlan">0H</td>
                                    <td id="totalAct">0H</td>
                                    <td id="totalRate">0%</td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>

                <div class="check-section">
                    <h4>2. 실전 모의고사 응시 여부 <span class="req">*</span></h4>
                    <div class="mock-tile-group">
                        <div class="mock-tile selected" onclick="selectMockType('none', this)">
                            <span class="icon">🚫</span>
                            <span class="label">미응시</span>
                        </div>
                        <div class="mock-tile" onclick="selectMockType('school', this)">
                            <span class="icon">🏫</span>
                            <span class="label">교내</span>
                        </div>
                        <div class="mock-tile" onclick="selectMockType('edu', this)">
                            <span class="icon">🏛️</span>
                            <span class="label">평가원/청</span>
                        </div>
                        <div class="mock-tile" onclick="selectMockType('private', this)">
                            <span class="icon">📝</span>
                            <span class="label">사설</span>
                        </div>
                    </div>
                    <input type="hidden" id="mockExamType" value="none">

                    <div id="mockExamFields" style="display:none; margin-top:20px;">
                        <div class="file-upload-box">
                            <label>📝 성적 인증 사진 첨부 (필수)</label>
                            <input type="file" id="mockExamProof" accept="image/*">
                        </div>
                        <div class="score-input-grid">
                            <div><label>국어</label><input type="number" placeholder="원점수" class="mock-score"></div>
                            <div><label>수학</label><input type="number" placeholder="원점수" class="mock-score"></div>
                            <div><label>영어</label><input type="number" placeholder="등급" class="mock-score"></div>
                            <div><label>탐구1</label><input type="number" placeholder="원점수" class="mock-score"></div>
                            <div><label>탐구2</label><input type="number" placeholder="원점수" class="mock-score"></div>
                        </div>
                    </div>
                </div>

                <div class="check-section">
                    <h4>3. 최근 2주 학업 추이 <span class="req">*</span></h4>
                    <div class="trend-radio-group">
                        <label><input type="radio" name="studyTrend" value="up" onchange="toggleSlumpReason()"> 📈 상승</label>
                        <label><input type="radio" name="studyTrend" value="keep" onchange="toggleSlumpReason()"> ➖ 유지</label>
                        <label><input type="radio" name="studyTrend" value="down" onchange="toggleSlumpReason()"> 📉 하락</label>
                    </div>

                    <div id="slumpReasonBox" style="display:none; margin-top:15px; background:#fff1f2; padding:15px; border-radius:8px;">
                        <label class="sub-label">⚠️ 하락 원인 (중복 선택 가능)</label>
                        <div class="checkbox-group">
                            <label><input type="checkbox" value="overplan"> 계획 과다</label>
                            <label><input type="checkbox" value="sense"> 실전 감각 저하</label>
                            <label><input type="checkbox" value="condition"> 컨디션/건강</label>
                            <label><input type="checkbox" value="etc"> 기타</label>
                        </div>
                        <input type="text" id="slumpDetail" placeholder="구체적인 이유를 간단히 적어주세요." style="width:100%; margin-top:10px;">
                    </div>
                </div>

                <div class="check-section">
                    <h4>4. 이번 주 핵심 회고 <span class="req">*</span></h4>
                    <p class="desc">공부하면서 가장 막혔던 한 가지만 적어주세요.</p>
                    <textarea id="weekComment" maxlength="200" placeholder="예: 수학 준킬러 문제 풀이 속도가 너무 느려서 고민이다. (200자 이내)" oninput="checkLength(this)"></textarea>
                    <div class="char-count"><span id="currLen">0</span>/200</div>
                </div>

            </div>
            <div class="modal-footer">
                <button class="save-btn" onclick="submitWeeklyCheck()">작성 완료 및 제출</button>
            </div>
        </div>
    </div>

    <div id="deepCoachingModal" class="modal">
        <div class="modal-content pro-modal-content">
            <div class="pro-modal-header">
                <div class="header-text">
                    <h2>1:1 심층 컨설팅 요청</h2>
                    <p>현재 고민을 구체적으로 적어주시면, 24-48시간 내에 전문 솔루션이 제공됩니다.</p>
                </div>
                <span class="close-btn pro-close" onclick="closeDeepModal()">&times;</span>
            </div>
            
            <div class="modal-body scrollable pro-body">
                <div class="pro-input-card">
                    <div class="card-title"><i class="fas fa-calendar-check"></i> 학습 계획 점검</div>
                    <p class="card-desc">현재 세우고 있는 계획의 문제점이나 확신이 없는 부분을 적어주세요.</p>
                    <textarea class="pro-textarea" maxlength="200" placeholder="예: 하루 14시간 계획을 세우는데 자꾸 밀립니다. 현실적인 수정이 필요합니다." oninput="updateCharCount(this)"></textarea>
                    <div class="char-count"><span>0</span>/200</div>
                </div>

                <div class="pro-input-card">
                    <div class="card-title"><i class="fas fa-compass"></i> 학습 방향성 설정</div>
                    <p class="card-desc">현재 공부하고 있는 방향이 맞는지, 입시 전략과 일치하는지 고민을 적어주세요.</p>
                    <textarea class="pro-textarea" maxlength="200" placeholder="예: 정시 파이터인데 내신 기간에 수능 공부 밸런스를 어떻게 잡아야 할까요?" oninput="updateCharCount(this)"></textarea>
                    <div class="char-count"><span>0</span>/200</div>
                </div>

                <div class="pro-input-card">
                    <div class="card-title"><i class="fas fa-book-open"></i> 취약 과목 솔루션</div>
                    <p class="card-desc">성적이 오르지 않는 특정 과목의 구체적인 증상을 적어주세요.</p>
                    <textarea class="pro-textarea" maxlength="200" placeholder="예: 수학 준킬러에서 시간이 너무 오래 걸립니다. 기출 분석은 2회독 했습니다." oninput="updateCharCount(this)"></textarea>
                    <div class="char-count"><span>0</span>/200</div>
                </div>

                <div class="pro-input-card">
                    <div class="card-title"><i class="fas fa-comment-dots"></i> 기타 멘탈 관리</div>
                    <p class="card-desc">슬럼프, 불안감 등 학습 외적인 고민이 있다면 자유롭게 적어주세요.</p>
                    <textarea class="pro-textarea" maxlength="200" placeholder="자유롭게 작성해주세요." oninput="updateCharCount(this)"></textarea>
                    <div class="char-count"><span>0</span>/200</div>
                </div>
            </div>

            <div class="modal-footer pro-footer">
                <button class="save-btn pro-btn" onclick="submitDeepCoaching()">컨설팅 요청하기</button>
            </div>
        </div>
    </div>

    <script src="js/config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/mypage.js"></script>
</body>
</html>