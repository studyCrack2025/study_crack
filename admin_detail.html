<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>학생 상세 관리 - StudyCrack Admin</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/admin.css">
    <link rel="stylesheet" href="css/admin_detail.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>

    <div class="admin-header-bar">
        <div class="header-title">
            <span>🔒 학생 상세 관리 시스템</span>
        </div>
        <a href="admin.html" class="back-btn">← 목록으로 돌아가기</a>
    </div>

    <div class="detail-container">
        
        <aside class="profile-card">
            <img src="assets/images/sample_profile.png" alt="프로필" class="profile-img">
            <h2 id="viewName" class="profile-name">Loading...</h2>
            <p id="viewEmail" class="profile-email">-</p>
            
            <div id="tierBadgeArea"></div>
            
            <div class="analysis-status-box">
                <span class="status-label">REPORT STATUS</span>
                <div id="analysisStatusBadge" class="analysis-badge pending">대기중</div>
            </div>
        </aside>

        <main class="main-content-area">
            
            <div class="memo-card">
                <div class="memo-header">
                    <h3>📝 관리자 전용 메모 <small>(학생에게 보이지 않습니다)</small></h3>
                </div>
                <textarea id="adminMemoInput" class="memo-input" placeholder="상담 내역이나 특이사항을 기록하세요."></textarea>
                <div style="overflow: hidden;">
                    <button onclick="saveAdminMemo()" class="memo-btn">메모 저장</button>
                </div>
            </div>

            <div class="tab-card">
                <div class="tabs">
                    <button class="tab-btn active" onclick="switchTab('info')">학생 정보</button>
                    <button class="tab-btn" onclick="switchTab('qual')">정성 조사서</button>
                    <button class="tab-btn" onclick="switchTab('quan')">성적 데이터</button>
                    <button class="tab-btn" onclick="switchTab('weekly')">📅 주간 점검</button>
                    <button class="tab-btn" id="btnSpecialTab" onclick="trySwitchSpecialTab()">👑 특별 상담</button>
                    
                    <button class="tab-btn" onclick="switchTab('pay')">결제 내역</button>
                    <button class="tab-btn highlight" onclick="switchTab('analysis')">📊 분석 리포트</button>
                </div>

                <div id="tab_info" class="tab-content active">
                    <div class="info-layout">
                        <div class="info-header-card">
                            <div class="info-icon-large">🎓</div>
                            <div class="info-header-text">
                                <h3>기본 인적사항</h3>
                                <p>학생의 연락처 및 학교 정보입니다.</p>
                            </div>
                        </div>
                        
                        <div class="info-details-grid">
                            <div class="detail-item">
                                <span class="detail-label">🏫 소속 학교</span>
                                <span class="detail-value" id="viewSchool">-</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">📞 전화번호</span>
                                <span class="detail-value" id="viewPhone">-</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">📧 이메일 (ID)</span>
                                <span class="detail-value" id="viewEmailFull">-</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">📅 가입 일자</span>
                                <span class="detail-value" id="viewJoinDate">-</span>
                            </div>
                        </div>

                        <div class="univ-summary-section">
                            <h4>🎯 목표 대학 설정 현황</h4>
                            <div id="viewTargetUnivList" class="target-univ-list">
                                <p style="color:#94a3b8;">설정된 목표 대학이 없습니다.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="tab_qual" class="tab-content">
                    <div id="qualContentArea"></div>
                </div>

                <div id="tab_quan" class="tab-content">
                    <div id="viewScoreTable"></div>
                </div>

                <div id="tab_weekly" class="tab-content">
                    <div class="consult-header">
                        <h3>주간 학습 점검 리포트</h3>
                        <p>학생이 제출한 매주 학습 계획 및 달성률입니다.</p>
                    </div>
                    
                    <div class="filter-bar">
                        <select id="filterYear" onchange="renderWeeklyTab()"></select>
                        <select id="filterMonth" onchange="renderWeeklyTab()"></select>
                    </div>

                    <div id="weeklyListContainer" class="timeline-container">
                        </div>
                </div>

                <div id="tab_special" class="tab-content">
                    <div class="consult-header">
                        <h3>특별 상담 내역</h3>
                        <p>Deep Coaching(Pro 이상) 및 1:1 Consulting(Black 전용) 내역입니다.</p>
                    </div>
                    <div id="specialListContainer" class="special-list-grid">
                        </div>
                </div>

                <div id="tab_pay" class="tab-content">
                    <div class="pay-summary-container">
                        <div class="pay-stat-box">
                            <span class="pay-stat-label">총 결제 금액</span>
                            <span class="pay-stat-value total" id="payTotalAmount">0원</span>
                        </div>
                        <div class="pay-stat-box">
                            <span class="pay-stat-label">최근 결제일</span>
                            <span class="pay-stat-value" id="payLastDate">-</span>
                        </div>
                    </div>
                    <div class="payment-list-wrapper">
                        <table class="payment-table-modern">
                            <thead>
                                <tr>
                                    <th>결제 상품</th>
                                    <th>결제 일시</th>
                                    <th style="text-align:right;">금액</th>
                                </tr>
                            </thead>
                            <tbody id="viewPaymentList"></tbody>
                        </table>
                    </div>
                </div>

                <div id="tab_analysis" class="tab-content">
                    <div class="analysis-header">
                        <h3>종합 분석 리포트 작성</h3>
                        <span class="analysis-guide">※ 저장 버튼을 누르면 학생에게 '분석 완료' 알림이 전송됩니다.</span>
                    </div>
                    <textarea id="analysisEditor" class="analysis-editor" placeholder="[분석 가이드]&#13;&#10;1. 현재 위치 분석&#13;&#10;2. 지원 전략 (상향/적정/안정)&#13;&#10;3. 학습 조언"></textarea>
                    <button onclick="saveAnalysis()" class="save-analysis-btn">✅ 분석 완료 및 저장 (학생에게 알림)</button>
                </div>
            </div>
        </main>
    </div>

    <div id="detailModal" class="modal-overlay" style="display:none;">
        <div class="modal-window">
            <div class="modal-header">
                <h3 id="modalTitle">상담 상세 내용</h3>
                <span class="close-modal" onclick="closeModal()">&times;</span>
            </div>
            <div class="modal-body" id="modalContent">
                </div>
        </div>
    </div>

    <script src="js/config.js"></script>
    <script src="js/admin_detail.js"></script>
</body>
</html>